<html>
<head>
 <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
 <style>
 .buscard{
 width:240px;
 height:300px;
 display:inline-block;
 margin:20px;
 text-align:center;
 overflow-y:auto;
 overflow-x:hidden;
 
 }
 #buscard-title{
 }
 .mdc-chip-set{
 display:block;
 }
 
 </style>
 <script>
 var $=(c)=>document.querySelector(c);

var template= `	<div class="mdc-card buscard" >
		
	  <h2 id="buscard-title" class="mdc-typography mdc-typography--headline6">=======BUS=======</h2>
	
<div>
趟次:
<select>
=======CHIPS=======
</select>
</div>
<div>
里程:
<select>
=======CHIPS2=======
</select>
</div>
  <h6 id="buscard-title" class="mdc-typography mdc-typography--headline6">最近评价</h2>
    
<ul class="mdc-list">

=======STARS=======

  
</ul>


 <div class="mdc-line-ripple"></div>


		
		</div>
		</div>
		`;
var chiptemp=`
<option value="======CHIP2======">======CHIP1======</option>
`;
var startemp=`<li class="mdc-list-item" tabindex="0">
    <span class="mdc-list-item__text">======STAR======</span>
  </li>
  `;


function refresh(){
fetch("https://abus.xysbs.cn:8080/WEBINFO").then((ret)=>ret.json()).then((data)=>{
	
	let result="";
	for(var i in data){
	let built=template;
	built=built.replace("=======BUS=======",i);
	
	
	let chips="";
	if(!data[i].run.loops)data[i].run.loops=0;
	if(!data[i].run.meters)data[i].run.meters=0;
	
	//chips+=chiptemp.replace("======CHIP1======","总趟次:"+.loops);
	
		for(var k in data[i].run.loops)
		{
	chips+=chiptemp.replace("======CHIP2======","趟次:"+data[i].run.loops[k])
			.replace("======CHIP1======",k+"  "+data[i].run.loops[k]+"趟");
		}
		
	built=built.replace("=======CHIPS=======",chips);
	chips="";	
	for(var k in data[i].run.meter)
		{
	chips+=chiptemp.replace("======CHIP2======","里程:"+parseFloat(data[i].run.meter[k]/1000).toFixed(2)+"km")
			.replace("======CHIP1======",k+"  "+parseFloat(data[i].run.meter[k]/1000).toFixed(2)+"km");
		}
	built=built.replace("=======CHIPS2=======",chips);
	
	let stars="";
	if(!data[i].run.stars)data[i].run.stars=[];
	
	for(var j in data[i].run.stars)
	stars+=startemp.replace("======STAR======",data[i].run.stars[j]);
	
	built=built.replace("=======STARS=======",stars);
	
	
	
	
	
	console.log(data[i]);
	
	
	result+=built;
	}
	
	$("#content").innerHTML=result;
	
	console.log(data);
	
});
		
		}
		
		
		
 </script>
</head>
<body onload="refresh()">

<div id="content"></div>

</body>
</html>
