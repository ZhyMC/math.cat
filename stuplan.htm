
<!DOCTYPE html>
<html>
<head>
  <script src="mdc/material-components-web.min.js"></script>
  <link href="mdc/material-components-web.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>学徒计划 - [软件研发中心 & UnderDOG工作室] - 阳光学院</title>

<style>
body{
background:#EEE;
width:100%;
height:100%;
margin:0;
}
#container{
min-height:80vh;
width:66vw;
margin-left:17vw;
margin-right:17vw;
margin-top:1vh;
}

#submit{
height:20vh;
}
.submitmedia{
margin-left:20px;
}
.submitinfo{
color:#666;
}
.submitkind{
color:#444;
font-size:12px;
}
#url{
border:none;
outline:none;
border-bottom:1px solid;
}
.mdc-card__actions{
padding:20px;

}
#ranklist{
margin-top:5vh;
min-height:50vh;
padding-left:2vw;
padding-right:2vw;
padding-top:1vh;
margin-bottom:5vh;
width:68%;
float:left;
}
#pushlist{
padding-left:10px;
padding-right:10px;
padding-top:1vh;
margin-top:5vh;
margin-bottom:5vh;

min-height:50vh;

width:28%;
float:right;

	
}
#pushlist .mdc-list-item{
background-color:#EEE;
padding-left:0;
padding-right:0;
color:#555;
}
#pushlist img{
	width:50px;
	height:50px;
	margin-right:15px;
	border-radius:5px;
}
.rankLine{
height:16vh;
border-bottom:1px dashed;
overflow-y:auto;
}
.rankLevel{
text-align:center;
font-size:18px;
line-height:2vh;
font-weight:bold;
margin-bottom:1vh;
margin-top:1vh;
}
.rankCompete{
display:inline-block;
margin-top:1vh;
margin-right:2vw;
border:1px solid;
padding:2px;
border-radius:3px;
}
.rankCompete img{
height:5vh;
width:5vh;
}
#pushInfo{
opacity:0;
transition:opacity 3s;
}
#infoArea{
position:absolute;
left:73vw;
top:9vh;
width:10vw;
height:10vh;
}

#avatarimg{
height:8vh;
width:8vh;
border:1px solid;
border-radius:2px;
}
#avatar{
text-align:center;
width:8vh;

}
#name{
text-align:center;
color:#888;
line-height:2vh;

}
#rankscore{
color:#666;
font-size:13px;
line-height:2vh;

margin-top:1vh;
border-bottom:1px solid;
}
#compete{
margin-top:3vh;
padding-left:10vw;
padding-right:10vw;
height:25vh;
text-align:center;
display:block !important;
}
#compete img{
height:10vh;
width:10vh;
vertical-align:middle;
margin:10px;
}
.competeinfo{
margin-top:2vh;
line-height:2vh;
padding-bottom:0.2vh;
border-bottom:1px solid #CCC;

}
.victory{
border:3px solid green;
}
.defeat{
border:3px solid red;
}

@media screen and (max-width: 1200px) {
    #container {
      width:90vw;
margin-left:5vw;
margin-right:5vw;
  
    }
	#pushlist{
	width:100%;
	clear:both;
	margin-top:0;
	
	}
	#ranklist{
	width:100%;
	clear:both;
	}	
	
}

#title{
text-align:center;
margin-bottom:2vh;
}
#l_title{
text-align:center;

color:#777;
padding-bottom:4px;
}
</style>

</head>

<body>
	<div id="container">
	
	
<div id="title" class="mdc-card">
阳光学院 学徒计划
</div>
	<div id="submit" class="mdc-card">

				<div id="infoArea">
						<div id="avatar">
						<img id="avatarimg" src="student.svg"></img>
						<div id="name">学生</div>
						<div id="rankscore">0</div>
						
						</div>
				</div>


	
	  <div class="mdc-card__primary-action">
    <div class="mdc-card__media mdc-card__media--square">
      <div class="mdc-card__media-content submitmedia">
	   <h2 class="mdc-typography mdc-typography--headline6">本周任务 <span class="submitkind">[<span id="typename">加载中</span>]</span></h2>
      
    <h3 class="mdc-typography mdc-typography--subtitle2 submitinfo"><span id="task">暂未发布 等待小组管理者发布</span></a></h3>
    
	  </div>
    
	</div>
  </div>
		<div class="mdc-card__actions">
	
	<div id="pushUrl">
	<input id="url"></input>
	
	</div>

  <button id="pushResult" onclick="pushResult($('#url').value)" class="mdc-button mdc-card__action mdc-card__action--button">
    <span class="mdc-button__label">提交作品链接</span>
  
  </button>

  <span id="pushInfo">提交成功!</span>
    
</div>

	</div>
	<div id="compete" class="mdc-card">
	<img id="head1" src="student.svg"/>
	vs
	<img id="head2" src="student.svg"/>
	<div id="competeinfo1" class="competeinfo"></div>
	<div id="competeinfo2" class="competeinfo"></div>
	
	</div>
	
	
	<div id="ranklist" class="mdc-card">
		
		</div>
	
	<div id="pushlist" class="mdc-card">
		<div id="l_title">已提交</div>
		
		<ul id="pushl" class="mdc-list">
		
		</ul>

		</div>
	
	
	
	</div>
	</div>
	


</body>

<script>
var $=(c)=>document.querySelector(c);
function getCookie(c_name)
{
if (document.cookie.length>0)
  {
  c_start=document.cookie.indexOf(c_name + "=")
  if (c_start!=-1)
    { 
    c_start=c_start + c_name.length+1 
    c_end=document.cookie.indexOf(";",c_start)
    if (c_end==-1) c_end=document.cookie.length
    return unescape(document.cookie.substring(c_start,c_end))
    } 
  }
  return "omxk63";
}

mdc.ripple.MDCRipple.attachTo($('.mdc-button'));
mdc.ripple.MDCRipple.attachTo($('.mdc-card__primary-action'));

function getRankSet(rank){
if(rank==0)
	return "黄铜 V";
else if(rank==1)
	return "黄铜 III";
else if(rank==2)
	return "黄铜 I";
else if(rank==3)
	return "白银 V";
else if(rank==4)
	return "白银 III";
else if(rank==5)
	return "白银 I";
else if(rank==6)
	return "黄金 V";
else if(rank==7)
	return "黄金 III";
else if(rank==8)
	return "黄金 I";
else if(rank==9)
	return "白金 V";
else if(rank==10)
	return "白金 III";
else if(rank==11)
	return "白金 I";
else if(rank==12)
	return "钻石 V";
else if(rank==13)
	return "钻石 III";
else if(rank==14)
	return "钻石 I";
else if(rank>=15 && rank<18)
	return "超凡大师";
else if(rank>=18)
	return "最强王者";
else return "未知段位";
}
function refreshRankList(type){

fetch("https://abus.xysbs.cn:2020/?action=viewrank&type="+type).then((ret)=>ret.json()).then((obj)=>{

let built="";
let lvls=Object.keys(obj);
lvls.sort((a,b)=>b-a);

let pushed=[];
for(var i in lvls)
{
let ind=lvls[i];
built+=`<div class="rankLevel"> - `+getRankSet(ind)+` - </div><div class="rankLine">`;

for(var j in obj[ind])
{

	if(obj[ind][j][0].push.length>0)
		pushed.push(`<li class="mdc-list-item"><img src=`+obj[ind][j][0].head+`></img><span class="mdc-list-item__text">`+/*obj[ind][j][0].nick+*/"提交 "+obj[ind][j][0].push+`</span></li>`);
	if(obj[ind][j][1].push.length>0)
		pushed.push(`<li class="mdc-list-item"><img src=`+obj[ind][j][1].head+`></img><span class="mdc-list-item__text">`+/*obj[ind][j][1].nick+*/"提交 "+obj[ind][j][1].push+`</span></li>`);
	
if(obj[ind][j][0].win){
	
	built+=`<div class="rankCompete">
			<img style='vertical-align:middle;border:3px solid `+((obj[ind][j][0].win==1)?'green':'red')+`;' src="`+obj[ind][j][0].head+`" />
			<span class="vs">vs</span>
			<img style='vertical-align:middle;border:3px solid `+((obj[ind][j][1].win==2)?'green':'red')+`;' src="`+obj[ind][j][1].head+`" />
			
			</div>`;
	
	}
	else
	
		built+=`<div class="rankCompete">
			<img style="vertical-align:middle;" src="`+obj[ind][j][0].head+`" />
			<span class="vs">vs</span>
			<img style="vertical-align:middle;" src="`+obj[ind][j][1].head+`" />
			
			</div>`;
	
}
			
built+="</div>";
}
			
	$("#ranklist").innerHTML=built;		
	$("#pushl").innerHTML=pushed.join('');		
			

});
}

function pushResult(result){
fetch("https://abus.xysbs.cn:2020/?action=pushresult&pswd="+getCookie("password")+"&result="+encodeURIComponent(result)).then((ret)=>ret.json()).then((obj)=>{
$("#pushInfo").style.opacity="1";
setTimeout(()=>$("#pushInfo").style.opacity="0",3000);


})


}
function refreshInfo(){
fetch("https://abus.xysbs.cn:2020/?action=getinfo&pswd="+getCookie("password"))
.then((ret)=>ret.json()).then((obj)=>{
if(obj.nick){
$("#url").value=obj.push;
$("#avatarimg").src=obj.headimgurl;
$("#name").innerHTML=obj.nick;
$("#rankscore").innerHTML=getRankSet(obj.info.rank);

if(obj.task)
$("#task").innerHTML=obj.task;

$("#typename").innerHTML=obj.type;
refreshRankList(obj.type);

if(obj.info1)
$("#competeinfo1").innerHTML=obj.info1;
if(obj.win || obj.win2)
$("#head1").setAttribute("class","competeinfo "+(obj.win?"victory":"defeat"));

if(obj.head1)
$("#head1").src=obj.head1;
else
$("#head1").src="student.svg";

if(obj.info2)
$("#competeinfo2").innerHTML=obj.info2;

if(obj.head2)
$("#head2").src=obj.head2;
else
$("#head2").src="student.svg";

if(obj.win || obj.win2)
$("#head2").setAttribute("class","competeinfo "+(obj.win2?"victory":"defeat"));


}
})}




refreshInfo();

</script>

 </html>
